<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ubah Data Penduduk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .jarak { padding-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <h3>Ubah Data Penduduk</h3>
        
        <div class="alert alert-primary" id="sukses">Perubahan Data Penduduk Sukses</div> 
        <div class="alert alert-warning" id="gagal">Perubahan Data Penduduk Gagal</div> 

        <form id="formDataPenduduk" method="POST">
            <input type="hidden" id="txID" name="txID" />
            <div class="form-group">
                <label class="form-label">NIK</label>
                <input class="form-control" type="text" id="txNIK" name="txNIK" disabled />
            </div>  
            <div class="form-group">
                <label class="form-label">Nama</label>
                <input class="form-control" type="text" id="txNAMA" name="txNAMA" />
            </div>
            <div class="form-group">
                <label class="form-label">Tanggal Lahir</label>
                <input class="form-control" type="date" id="txTGL" name="txTGL" />
            </div>
            <div class="form-group">
                <label class="form-label">Alamat</label>
                <input class="form-control" type="text" id="txALAMAT" name="txALAMAT" />
            </div> 
            <div class="form-group jarak">
                <button type="submit" id="cmdSIMPAN" class="btn btn-primary">Simpan</button>
                <a class="btn btn-warning" href="datapenduduk.html">Batal</a>
            </div>      
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $("#sukses").hide();
        $("#gagal").hide();

        const params = new URLSearchParams(window.location.search);
        const idpenduduk = params.get("id");

        // Ambil data penduduk berdasarkan ID
        $.getJSON(`server/pendudukbyid.php?id=${idpenduduk}`, function(data) {
            if(data && data.error == '0') {
                $("#txID").val(data.id);
                $("#txNIK").val(data.nik);
                $("#txNAMA").val(data.nama);
                $("#txTGL").val(data.tanggal_lahir);
                $("#txALAMAT").val(data.alamat);
            } else {
                $("#gagal").show();
            }
        });

        // Update data
        $("#formDataPenduduk").submit(function(e){
            e.preventDefault();
            let dta = {
                id: $("#txID").val(),
                nama: $("#txNAMA").val(),
                tanggal_lahir: $("#txTGL").val(),
                alamat: $("#txALAMAT").val()
            };

            $.ajax({
                url: "server/pendudukupdate.php",
                type: "POST",
                dataType: "json",
                data: dta,
                success: function(hsl){
                    if(hsl["error"] == '0'){
                        $("#sukses").show();
                        $("#gagal").hide();
                    } else {
                        $("#gagal").show();
                        $("#sukses").hide();
                    }
                },
                error: function(){
                    $("#gagal").show();
                    $("#sukses").hide();
                }
            });

            setTimeout(() => {
                window.location.href = "datapenduduk.html";
            }, 2000);
        });
    </script>
</body>
</html>
